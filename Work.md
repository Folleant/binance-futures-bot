### Разработка бота Binance Futures (Node JS)

_Обновленное Задание, с дополнениями._
_____________
- #### **Начало (Введение)**
**Цель:** Нужно разработать торгового бота для взаимодействия и работы с Binance Futures. Основная цель бота, это принимать входящие POST запросы от Trading View и в зависимости от полученных запросов выполнять соответственные действия на бирже Binance.
_____________

- #### **Разработка (Задания)**

1. Получение и обработка входящих POST запросов от Trading View:
При получение входящих POST запросов от Trading View мы получаем данные в таком виде:
- **BINANCE MATICUSDT 1h SI BUY** (Сигнал BUY/SELL)
- **BINANCE BTCUSDT 1d TR -0.21** (Направление тренда сигнала)
- **BINANCE SOLUSDT 2h MA 20.01** (Скользящая средняя сигнала)
Формат данных: **[EXCHANGE][PAIR][TIMEFRAME][INDICATOR][VALUE]**
Exchange = название биржи (Binance)
Pair = название торговой пары (BTCUSDT)
Timeframe = временной интервал, на котором идет анализ (1h)
Indicator = тип индикатора (SI, TR, MA)
Value = значение индикатора (BUY, -0.25, 20.01)

___________________________

- #### **Правила торговли и работы**

- [ ] **Открытие позиций на бирже:**
Если приходит от Trading View запрос с индикатором SI и значением BUY, то нужно сразу открывать LONG позицию, и сразу же открывать стоп-лосс и тейк-профит для этой позиции.
Если приходит такой же запрос но с значением SELL, то сразу открываем SHORT позицию, и так же выставляем стоп-лосс и тейк-профит для этой позиции.

Если например мы открывали лонг по лайткоину на 1ч таймфрейме (BINANCE LTCUSDT 1h SI BUY), тогда мы ловим обратный сигнал вот такой: BINANCE LTCUSDT 1h SI SELL

- [ ] **Условия проверки для открытия позиций**
После получения индикатора SI от Trading View мы сначала должны выполнить проверку условий, и если все условия верны то тогда все окей, и мы должны открывать позицию, если одно из условий будет не верно то позиция не должна открываться.

При получение от Trading View запроса с индикатором SI мы обращаемся к проверке условий, для проверки всех 5 условий. К примеру нам пришел сигнал на покупку BINANCE LTCUSDT 3h SI BUY и переходим к проверке:
**Условия для проверки:**
1. Сигнал противоположен направлению тренда 1d
Надо что бы по этой монете смотреть на последний 1d TR сигнал чтобы он был отрицательным, например BINANCE LTCUSDT 1d TR -0.5
Нужно смотреть на последний запрос пришедший по той же торговой паре с индикатором TR 1d и проверять что сигнал противоположен направлению тренда.

2. Сигнал совпадает с направлением локального тренда, в том числе по всем старшим таймфреймам (Не учитывать только 1d таймфрейм)
Надо что бы по всем таймфреймам кроме младших и кроме таймфрейма 1d, направления тренда TR совпадало с сигналом. То есть нам пришел сигнал на 3h таймфрейме. Значит мы проверяем тренды 3h и 4h таймфреймов, посколько нам пришел BUY сигнал, значит эти тренды должны быть положительными.

3. Текущая цена отличается от последней скользящей средней того же таймфрейма не больше чем на 3%
Тут мы сравниваем с последним значение MA по такому же таймфрейму которое нам так же приходит запросом с Trading View.

4. Индикатор не перегрет (Если за последние 20 тиков (свеч) было получено максимум 3 сигнала buy/sell.
Можно где-то хранить данные о том сколько сигналов buy/sell мы получили по каждой монете и по каждому таймфрейму за последние 20 часов (1h). И уже при открытии сделки проверять, если там больше 3, тогда считаем что индикатор перегрет и сделку не открываем. Можно например в начале каждого часа проверять не пришел ли сигнал и заполнять данные в какой-нибудь массив, где будут храниться все сигналы за последние 20 свечей по каждой монете и по каждому таймфрейму
Главное что бы при перезапуске скрипта эти значения не терялись и сохранялись где-то

5. Еще нет открытой позиции по данной торговой паре.


**Небольшое пояснение о индикаторах:**
TR и MA индикаторы - приходят в каждом баре, а индикатор SI приходит только когда сигналы на покупку или продажу.
TR - это индикатор текущего тренда. Если его значение положительное, то значит что тренд положительный и наоборот если значение отрицательное то значит и тренд отрицательный.
MA - это значение текущей скользящей средней.


- [ ] **Определение размера позиции**
Размер позиции должен расчитываться таким образом, чтобы каждая новая позиция снижала баланс на 1/10 от суммы банка. (Если мы указываем 1000$, то при каждой новой сделке должно сниматься 100$. 1/10 часть суммы).

 Сумму банка мы задаем вручную. Можно в коде или в файле что бы задавалось как хотите. Но размер позиции должен расчитываться так что бы из баланса вычиталась 1/10 банка, который мы указали в коде. 

Например, мы задаем банк 100$. Тогда при открытии позиции баланс который отображен на скриншоте должен снижаться на 10$. Надо расчитать эту сумму позиции, учитывая плечо и текущую цену, что бы вычиталось ровно 10% (скриншоты прилагаю) По поводу знаков после запятой, когда реализуете этот механизм, попробуйте протестировать на btc например и на другой монете, поймете о чем я. Там был какой-то нюанс связаный со значением precision по каждой моенте, которое устанавливает binance.

- [ ] **Выход из позиции (Закрытие позиций)**
Выход из сделки происходит при получение обратного сигнала с того же таймфрейма, с которого была открыта позиция либо по тейк-профиту или стоп-лоссу. При выходе из позиции должны быть так же закрыты все ордера связанные с конкретно этой позицией, в том числе тейк-профит и стоп-лосс ордера.

Если стоплосс или тейкпрофит корректно заданы, то да, они должны автоматически закрыть одну позицию. 

- [ ] **Установка плеча для позиции**
Плечо зависит от таймфрейма на котором мы получили сигнал:
1. 4h = x5
3. 3h = x7
4. 2h = x9
5. 1h = x10

- [ ] **Установка стоп-лосса и тейк-профита**
Стоп-лосс и тейк-профит должны устанавливаться по следующим формулам, в зависимости от направления сделки:
Пояснение:
PRICE - цена при открытие сделки
LEVERAGE - плечо сделки
_Формула для определения стоп-лосса:_
priceDiff = 0.2 * price / leverage
Для LONG позиции: stopLossPrice = price - priceDiff
Для SHORT позиции: stopLossPrice = price + priceDiff
_Формула для определения тейк-профита:_
priceDiff = 0.1 * price / leverage
Для LONG позиции: takeProfitPrice = price + priceDiff
Для SHORT позиции: takeProfitPrice = price - priceDiff

- [ ] **Сохранение логов**
Нужно создать 2 файла для логов (ViewListOpenPosition.log и ViewListClosePosition.log)
ViewListOpenPosition.log - здесь должны храниться данные о позициях которые были открыты. 
Данные которые должны хранится: Дата, биржа, торговая пара, направление (long или short), таймфрейм, цена входа, цена стоп-лосса, цена тейк-профита, плечо, статус (Открыта или Закрыта).

ViewListClosePosition.log - здесь должны храниться данные о позициях которы были закрыты.
Данные которые должны хранится: Дата, биржа, торговая пара, направление (long или short), таймфрейм, цена входа, цена выхода, плечо, причина выхода из позиции (Обратный сигнал, стоп-лосс или тейк-профит).